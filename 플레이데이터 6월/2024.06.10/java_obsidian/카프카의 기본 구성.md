- 카프카는 데이터를 받아서 전달하는 데이터 버스(data bus)의 역할을 함 
- 데이터(메시지)를 만들어서 주는 쪽을 프로듀서(producer)
- 데이터(메시지) 빼내서 소비하는 쪽을 컨슈머(consumer)
- 주피커는 카프카의 정상 동작을 보장하기 위해 메타데이터(metadata)를 관리하는 코디네이터(coodinator)라 할 수 있음 
![[Pasted image 20240604000547.png]]
- 카프카는 중앙에 위치하여, 프로듀서로부터 받은 메시지들을 저장하고 컨슈머에게 전달하는 두 가지 역할을 함 
	- 카프카는 애플리케이션의 이름을 의미하며 
	- 브로커는 카프카 애플리케이션이 설치된 서버 또는 노드를 의미 
- 컨슈머는 카프카에 저장된 메시지를 꺼내오는 역할을 하며, 가져온 데이터를 엘라스틱서치, 하둡 같은 애플리케이션으로 전송하기도 하고, 메시지를 변형하여 다시 카프카로 전송하는등 다양한 방법으로 응용해 사용할 수 있음 

# 메시지 보내고 받기 
- 실습을 위해서는 토픽을 생성 
- 일반적으로 프로듀서가 카프카로 메시지를 전송할 때 카프카로 그냥 전송하는 것이 아니라, 카프카의 특정 토픽으로 전송하게 됨 
```bash
kafka-topics.sh --bootstrap-server broker1:9092,broker2:9092,broker3:9092 --create --topic encore-test --partitions 1 --replication-factor 3
```

```
Created topic encore-test.
```

- --bootstrap-server
	- 나열된 브로커 목록으로 Kafka 클러스트에 연결 한다. 
	- 이 목록의 브로커 중 하나가 응답하면 클라이언트는 해당 브로커를 통해 클러스터의 메타데이터를 가져온다 
- --create 
	- 토픽을 작성한다 
	- 토픽의 목록을 확인할 때는 --list
	- 토픽을 삭제할 때는 --delete 
- --topic 
	- 작성하는 토픽 이름을 지정 
	- 여기에서는 토픽 이름으로 first-test를 지정 
	- 토픽 이름에는 밑줄( _ )과 마침표( . ) 를 사용하지 않는다 
- --partitions
	- 작성하는 토픽의 파티션 수를 지정 
	- 위 예제에서는 파티션 수를 3으로 설정 
- --replication-factor
	- 작성하는 토픽의 레플리카(복사본)의 수를 지정 
	- 3대의 서버를 사용하는 경우 3을 지정 
	- 이 값은 카프카 클러스터의 브로커 수 이하여야 함 
	- 만약 서버 1대로 구성한 클러스터에서 이 값을 3으로 지정하면 오류가 발생 

```bash
kafka-topics.sh --bootstrap-server broker1:9092,broker2:9092,broker3:9092 --describe --topic encore-test
```

```
Topic: first-app2       TopicId: qt3_el6fSZG1LdblLws6ew PartitionCount: 3       ReplicationFactor: 3    Configs: segment.bytes=1073741824
        Topic: first-app2       Partition: 0    Leader: 3       Replicas: 3,2,1 Isr: 3,2,1
        Topic: first-app2       Partition: 1    Leader: 1       Replicas: 1,3,2 Isr: 1,3,2
        Topic: first-app2       Partition: 2    Leader: 2       Replicas: 2,1,3 Isr: 2,1,3
```
- Topic, PartitionCount, ReplicationFactor
	- 지정한 토픽의 이름 
	- 파티션의 수 
	- Replication-Factor 표시 
- Leader
	- 각 파티션의 현재 Leader Replica가 어떤 브로커에 존재하고 있는지 표시 
	- 여기에 표시된 번호는 각 브로커에 설정한 브로커 ID
- Replicas
	- 각 파티션의 레플리카(복사본)를 보유하고 있는 브로커의 목록 
- Isr
	- In-Sync Replicas의 약자로 복사본 중 Leader Replica와 올바르게 동기가 실행된 복제본을 보유하고 있는 브로커 목록이 표시 
	- 장애가 발생하고 있는 브로커를 보유하고 있거나, 특정 이유로 Leader Replica의 동기화가 실행되지 않은 레플리카는 In-Sync Replicas에 포함 되지 않음 
- 

----
- 위의 출력 내용을 통해 토픽 생성 완료 메시지를 확인했다면 이제 프로듀서를 이용해 메시지를 보낼 준비가 된 것 
- 프로듀서를 이용해 메시지를 전송하고, 컨슈머를 이용해 메시지를 가져오는 예제를 작성 
## 컨슈머 
```bash
kafka-console-consumer.sh --bootstrap-server broker1:9092,broker2:9092,broker3:9092 --topic encore-test
```

## 프로듀서 
```bash
kafka-console-producer.sh --broker-list broker1:9092,broker2:9092,broker3:9092 --topic encore-test
```
- 프로듀서 창에서 메시지를 전달하면 컨슈머 창에 메시지가 전달되어야 함 


# 정리 
- kafka-topics.sh
	- 토픽을 생성하거나 토픽의 설정 등을 변경하기 위해 사용 
- kafka-console-producer.sh
	- 토픽으로 메시지를 전송하기 위해 사용
	- 기본 옵션 외 추가 옵션을 지정할 수 있고, 이를 통해 다양한 프로듀서 옵션 적용 가능 
- kafka-console-consumer.sh
	- 토픽에서 메시지를 가져오기 위해 사용 
	- 기본 옵션 외 추가 옵션을 지정할 수 있고, 이를 통해 다양한 컨슈머 옵션 적용 가능 
- kafka-reassign-partitions.sh
	- 토픽의 파티션과 위치 변경 등을 위해 사용 
- kafka-dump-log.sh
	- 파티션에 저장된 로그 파일의 내용을 확인하기 위해 사용 
